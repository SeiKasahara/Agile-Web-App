{# templates/main/share_data.html #}
{% extends "base.html" %}
{% from "components/button.html" import button %}
{% block title %}Share Your Data{% endblock %}
{% block content %}
    <div class="min-h-screen bg-black text-white flex items-start justify-center p-6">
        <div class="w-full max-w-3xl bg-white text-black rounded-lg shadow-lg p-6 space-y-6">
            <h2 class="text-2xl font-bold">Share Uploaded Data</h2>
            <form method="post" class="space-y-4">
                <div>
                    <label for="batch_id" class="block text-sm font-medium mb-1">Select Data Batch</label>
                    <select name="batch_id"
                            id="batch_id"
                            class="w-full rounded-md border-gray-300 px-3 py-2">
                        {% for b in batches %}
                            <option value="{{ b.id }}">{{ b.filename }} â€“ {{ b.uploaded_at.strftime("%Y-%m-%d %H:%M") }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="shared_to" class="block text-sm font-medium mb-1">Share With</label>
                    <select name="shared_to"
                            id="shared_to"
                            multiple
                            class="w-full h-32 rounded-md border-gray-300 px-3 py-2">
                        {% for u in users %}
                            <option value="{{ u.id }}">{{ u.email }} ({{ u.first_name }} {{ u.last_name }})</option>
                        {% endfor %}
                    </select>
                    <p class="text-xs text-gray-500 mt-1">Use Ctrl/Cmd+Click to select multiple.</p>
                </div>
                <div class="flex justify-end">{{ button("Save Sharing", svg_path=None, submit=True, variant="black") }}</div>
            </form>
            <div class="mt-8">
                <h3 class="text-lg font-semibold mb-2">Current Shares</h3>
                {% for b in batches %}
                    <div class="mb-4">
                        <p class="font-medium">{{ b.filename }}:</p>
                        <ul class="list-disc list-inside text-gray-700">
                            {% if shares_map[b.id] %}
                                {% for uid in shares_map[b.id] %}
                                    {% set u = users|selectattr('id','equalto',uid)|first %}
                                    <li>{{ u.email }} ({{ u.first_name }})</li>
                                {% endfor %}
                            {% else %}
                                <li class="text-gray-400">Not shared with anyone.</li>
                            {% endif %}
                        </ul>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}
